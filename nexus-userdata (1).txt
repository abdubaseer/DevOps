#!/bin/bash
sudo apt update
sudo apt upgrade -y
sudo apt install openjdk-17-jdk -y
sudo useradd -r -m -U -d /opt/nexus -s /bin/false nexus
#wget https://download.sonatype.com/nexus/3/latest-unix.tar.gz
wget https://download.sonatype.com/nexus/3/nexus-unix-x86-64-3.78.2-04.tar.gz
tar -xzvf nexus-unix-x86-64-3.78.2-04.tar.gz
sudo mv nexus-3* /opt/nexus/
sudo chown -R nexus:nexus /opt/nexus
#sudo nano /opt/nexus/nexus-3.76.1-01/etc/nexus.properties
#sudo ln -s /opt/nexus/nexus-3.76.1-01/bin/nexus /usr/bin/nexus
#sudo -u nexus /opt/nexus/nexus-3.76.1-01/bin/nexus start
sudo su
cat <<EOT>> /etc/systemd/system/nexus.service
[Unit]                                                                          
Description=nexus service                                                       
After=network.target                                                            
                                                                  
[Service]                                                                       
Type=forking                                                                    
LimitNOFILE=65536                                                               
ExecStart=/opt/nexus/nexus-3.78.2-04/bin/nexus start                                  
ExecStop=/opt/nexus/nexus-3.78.2-04/bin/nexus stop                                    
User=nexus                                                                      
Restart=on-abort                                                                
                                                                  
[Install]                                                                       
WantedBy=multi-user.target                                                      

EOT

echo 'run_as_user="nexus"' > /opt/nexus/nexus-3.78.2-04/bin/nexus.rc
systemctl daemon-reload
systemctl start nexus
systemctl enable nexus